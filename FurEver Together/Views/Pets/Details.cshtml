@model FurEver_Together.DataModels.Pet

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pet Details</title>
    <link rel="stylesheet" href="/css/pets.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #shelterMap {
            height: 300px;
            width: 100%;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .shelter-location-section
        {
            margin: 30px auto; 
            padding: 20px;
            background-color: #FBEAEB;
            border-radius: 10px;
            text-align: center;
            max-width: 1200px; 
            width: calc(100% - 80px); 
        }

        .shelter-location-section h3 {
            color: #2F3C7E;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .shelter-info {
            margin-bottom: 15px;
        }

        .shelter-info p {
            margin: 5px 0;
            font-size: 1rem;
        }

        .shelter-info .detail-label {
            font-weight: bold;
            color: #2F3C7E;
        }
    </style>
</head>
<body>
    <div class="pet-details-container">
       <div class="left-column">
    <h2>@Html.DisplayFor(model => model.Name)</h2>

    <div class="image-and-basics">
        <div class="image-container">
            @{
                var imageUrl = Model.PictureUrl;
                if (string.IsNullOrEmpty(imageUrl))
                {
                    imageUrl = "https://via.placeholder.com/250x300";
                }
            }
            <img id="petImage" src="@imageUrl" alt="Pet Image" onerror="handleImageError()" />
        </div>

        <div class="basic-details">
                    <p><span class="detail-label">Type:</span> @Html.DisplayFor(model => model.Type)</p>
                    <p><span class="detail-label">Breed:</span> @Html.DisplayFor(model => model.Breed)</p>
                    <p><span class="detail-label">Age:</span> @Html.DisplayFor(model => model.Age)</p>
                    <p><span class="detail-label">Gender:</span> @Html.DisplayFor(model => model.Gender)</p>
        </div>
    </div>

            <div class="details">
                <p><span class="detail-label">Description:</span></p>
                @Html.DisplayFor(model => model.Description)
            </div>

            <div class="arrival-date">
                <p><span class="detail-label">Arrival Date:</span> @Html.DisplayFor(model => model.ArrivalDate)</p>
            </div>
            <div class="extra-info-box">
                <p class="match-label">Your personality matches with a percentage of:</p>
                <p class="match-percentage">@((int)Math.Round((double)ViewData["MatchPercentage"]))%</p>
                @if (!Model.IsAdopted)
                {
                <form method="post" asp-controller="Adoptions" asp-action="Adopt" asp-route-petId="@Model.PetId">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="adopt-button">ADOPT NOW</button>
                </form>
                }
                else
            {
                    <p class="adopted-label">This pet has already found a lovely family.</p>
                }
            </div>
    </div>

        <div class="right-column">
            <h3>Personality Profile</h3>
            @{
                var personalityTraits = new List<(string Name, string? Value)>
            {
            ("Energy Level", Model.Personality?.EnergyLevel.ToString()),
            ("Sociability", Model.Personality?.Sociability.ToString()),
            ("Affection Level", Model.Personality?.AffectionLevel.ToString()),
            ("Trainability", Model.Personality?.Trainability.ToString()),
            ("Playfulness", Model.Personality?.Playfulness.ToString()),
            ("Aggression Level", Model.Personality?.AggressionLevel.ToString()),
            ("Noise Level", Model.Personality?.NoiseLevel.ToString()),
            ("Good With Kids", Model.Personality?.GoodWithKids.ToString()),
            ("Good With Other Pets", Model.Personality?.GoodWithOtherPets.ToString()),
            ("Adaptability", Model.Personality?.Adaptability.ToString()),
            ("Anxiety Level", Model.Personality?.AnxietyLevel.ToString())
            };

                var traitImages = new Dictionary<string, string>
            {
                ["Energy Level"] = "/uploads/Personality/EnergyLevel.png",
                ["Sociability"] = "/uploads/Personality/Sociability.png",
                ["Affection Level"] = "/uploads/Personality/AffectionLevel.png",
                ["Trainability"] = "/uploads/Personality/Trainability.png",
                ["Playfulness"] = "/uploads/Personality/Playfulness.png",
                ["Aggression Level"] = "/uploads/Personality/AggressionLevel.png",
                ["Noise Level"] = "/uploads/Personality/NoiseLevel.png",
                ["Good With Kids"] = "/uploads/Personality/GoodWithKids.png",
                ["Good With Other Pets"] = "/uploads/Personality/GoodWithOtherPets.png",
                ["Adaptability"] = "/uploads/Personality/Adaptability.png",
                ["Anxiety Level"] = "/uploads/Personality/AnxietyLevel.png"
            };
            }
            <div class="personality-grid">
                @foreach (var trait in personalityTraits)
                {
                    var imgSrc = traitImages.ContainsKey(trait.Name) ? traitImages[trait.Name] : "https://a1petmeats.com.au/wp-content/uploads/2019/11/no-image-available.jpg";

                    <div class="personality-item">
                        <img src="@imgSrc" alt="@trait.Name" />
                        <p class="trait-name">@trait.Name</p>
                        <p class="trait-value">@trait.Value</p>
                    </div>
                }
            </div>
        </div>
    </div>

    @if (Model.Shelter != null)
    {
        <div class="shelter-location-section">
            <h3>Shelter Location</h3>
            <div class="shelter-info">
                <p><span class="detail-label">Shelter Name:</span> @Model.Shelter.Name</p>
                <p><span class="detail-label">Address:</span> @Model.Shelter.Address</p>
                @if (!string.IsNullOrEmpty(Model.Shelter.PhoneNumber))
                {
                    <p><span class="detail-label">Phone:</span> @Model.Shelter.PhoneNumber</p>
                }
            </div>
            <div id="shelterMap"></div>
        </div>
    }

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        function handleImageError() {
            var placeholderUrl = "/uploads/Animals/no-image-available-pets.jpg";
            var imageElement = document.getElementById('petImage');
            imageElement.src = placeholderUrl;
        }

        @if (Model.Shelter != null)
        {
            <text>
            // Initialize the map
            var map = L.map('shelterMap').setView([@Model.Shelter.Latitude, @Model.Shelter.Longitude], 15);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);

            // Add a marker for the shelter
            var marker = L.marker([@Model.Shelter.Latitude, @Model.Shelter.Longitude]).addTo(map);
            marker.bindPopup('<b>@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Shelter.Name))</b><br>@Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Shelter.Address))').openPopup();
            </text>
        }
    </script>
</body>
</html>
